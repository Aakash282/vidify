<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="$views/css/image.css">
        <link rel="stylesheet" href="$views/css/list.css">
        <link rel="stylesheet" href="$views/css/buttons.css">
        <link rel="stylesheet" href="css/main.css">
        <link rel="stylesheet" href="css/github.css">
    </head>
    <body>
        <div id="wrapper">
            <div id="index" class="section">
                <h1>Vidify = Youtube + Spotify</h1>
                <p class="description">Opens the music video of the currently playing song. </p>

                <h3>Your video is opening now...</h3>
                <div class="html-snippet">
                    <div id="np"></div>
                </div>

                <script type="script/snippet">
                // import the spotify API
                    require(['$api/models'], function(models) {
                        // get access tp the currently playing song. 
                        var nowPlaying = document.getElementById('np');
                        console.log(nowPlaying);
                        function updateStatus(track) {
                            if (track === null) {
                                nowPlaying.innerHTML = 'No track currently playing';
                            } else {
                                nowPlaying.innerHTML = 'Searched: ' + track.name +
                                                    " By: " + track.artists[0].name;
                            }
                        }

                        // update on load
                        models.player.load('track').done(function(p) {
                            updateStatus(p.track);

                            // pause the song and write the query
                            models.player.pause();
                            console.log(p.track);
                            var query = p.track.name + " " + p.track.artists[0].name;
                            console.log(query);

                            // Now we load the query to send to the server
                            var serverURL = "https://s3.amazonaws.com/vidify/index.html?AWSAccessKeyId=ASIAISOD3AYWZUZYKJ3Q&Expires=1389031923&Signature=tpa8bhPhbFD3fXMvG8SAHbC1yr8%3D&x-amz-security-token=AQoDYXdzEHsawAI2ya2GWKgPiVIs/4TzBr%2BTapY9R6mq51gzsNpagX7P4XP9jLgTDq/6B3cUMC2M03n%2Bi8qp1j1wBLB5k/uNB78oQc2AWHS4X/rQjKSsvTqokb0nIwWapuNUVSqxA5Pt2nLdWoNWmzDESkbMAHv3lv34t0chxUbhq5TOfr02FF9pDZpKWEw4ZO72%2BgmZmdnfLsQankfL357qapmljDOLeA9x57H823LQk1KprbwOQOEaI7vf%2BE1l4DRrKd31igpEI1oCCEkvpa0WN%2BMdszS4NmApB7ZvDvOnl4dKbbkxNLUueeeiHqwIkQpxmMd3lScHFJ9sluKHZrCC1XMA/ojEaK/ISX/El2bnarRV8LF1a80CJRp7aIViwrY6dd0xxDYpM9HVXzpzOJoFEfwgtyDZQUqf8q2DikFb17PVqHnG2MXJaiCr2auWBQ%3D%3D&";
                            serverURL += escape(query);
                            window.open(serverURL);
                        });

                        // update on change
                        models.player.addEventListener('change', function(p) {
                            updateStatus(p.data.track);
                        });
                    });
                </script>
            </div>
        </div>
        <script src="/js/rainbow-custom.min.js"></script>
        <script src="/js/tutorial.js"></script>
        
    </body>
</html>
